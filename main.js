(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{l7:()=>W,Lu:()=>R,dm:()=>G});var t="https://nomoreparties.co",n="wff-cohort-31",o="90ce202b-d8aa-4699-9c69-f641495b1448",r="90ce202b-d8aa-4699-9c69-f641495b1448",c=function(){return fetch("".concat("https://nomoreparties.co/v1/wff-cohort-31","/users/me"),{method:"GET",headers:{authorization:r}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))};function a(e){e.classList.add("popup_is-opened"),e.addEventListener("click",l),document.addEventListener("keydown",u)}function i(e){e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),e.removeEventListener("click",l),document.removeEventListener("keydown",u)}var u=function(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))},l=function(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close"))&&i(e.currentTarget)},s=document.querySelector("#card-template").content,d=document.querySelector(".popup__delete-card");function f(e,r,c){var a=r.deleteCard,u=r.openImageModal,l=r.openDeleteModal,f=s.querySelector(".card").cloneNode(!0),p=f.querySelector(".card__image"),m=f.querySelector(".card__title"),v=f.querySelector(".card__delete-button"),y=f.querySelector(".card__like-button"),h=f.querySelector(".like__counter"),_=document.querySelector(".button__confirm");return p.src=e.link,p.alt=e.name,m.textContent=e.name,h.textContent=e.likes.length,p.addEventListener("click",(function(){var t=e.link,n=e.name;u(t,n)})),c._id===e.owner._id?v.addEventListener("click",(function(){l(),_.addEventListener("click",(function(){var r;(r=e._id,fetch("".concat(t,"/v1/").concat(n,"/cards/").concat(r),{method:"DELETE",headers:{authorization:o},body:JSON.stringify({cardId:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(){a(f),i(d)}))}))})):v.style.display="none",y.addEventListener("click",(function(){var r;e.likes.find((function(e){return c._id===e._id}))?((r=e._id,fetch("".concat(t,"/v1/").concat(n,"/cards/likes/").concat(r),{method:"DELETE",headers:{authorization:o}}).then((function(e){return e.ok?(console.log("Лайк удален ".concat(r)),e.json()):Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(t){e.likes=t.likes,h.textContent=t.likes.length})),y.classList.remove("card__like-button_is-active")):(function(e){return fetch("".concat(t,"/v1/").concat(n,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:o}}).then((function(t){return t.ok?(console.log("Лайк добавлен ".concat(e)),t.json()):Promise.reject("Ошибка: ".concat(t.status))})).catch((function(e){console.log(e)}))}(e._id).then((function(t){e.likes=t.likes,h.textContent=t.likes.length})),y.classList.add("card__like-button_is-active"))})),e.likes.find((function(e){return c._id===e._id}))&&y.classList.add("card__like-button_is-active"),f}function p(e){e.remove()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var v=document.forms.editProfile,y=v.elements.name,h=v.elements.description,_=document.forms.newPlace,b=_.elements.placeName,S=_.elements.link,g=document.forms.updateAvatar.elements.avatarLink;function k(e,t,n){var o=document.querySelector(".".concat(e.id,"-error"));e.classList.remove(t),o.textContent="",o.classList.remove(n)}function E(e,t){var n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,c=t.inputErrorClass,a=t.errorClass,i=e.querySelector(n);e.querySelectorAll(o).forEach((function(e){e.classList.add(r)})),k(i,c,a)}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var L,q,j,A,P,w,x,O=document.querySelector(".profile__edit-button"),I=document.querySelector(".profile__add-button"),T=document.querySelector(".popup_type_edit"),M=document.querySelector(".popup_type_new-card"),z=document.querySelector(".popup_type_image"),D=document.querySelector(".popup__delete-card"),B=document.querySelector(".popup__update-avatar"),N=document.querySelector(".profile__title"),J=document.querySelector(".profile__description"),U=document.querySelector(".profile__image"),G=document.querySelector(".places__list"),H=document.forms.editProfile,V=document.forms.newPlace,$=document.forms.updateAvatar,F=H.elements.name,K=H.elements.description,Q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function R(e,t){var n=document.querySelector(".popup__image"),o=document.querySelector(".popup__caption");n.src=e,o.textContent=t,a(z)}function W(){a(D)}O.addEventListener("click",(function(){F.value=N.textContent,K.value=J.textContent,a(T),E(editProfile,Q)})),H.addEventListener("submit",(function(e){!function(e,r,c,a){e.preventDefault();var u=y.value,l=h.value;c.textContent=u,a.textContent=l,function(e,r){fetch("".concat(t,"/v1/").concat(n,"/users/me"),{method:"PATCH",headers:{authorization:o,"Content-type":"application/json"},body:JSON.stringify({name:e,about:r,avatar:void 0})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(u,l),i(r)}(e,T,N,J)})),U.addEventListener("click",(function(){a(B)})),$.addEventListener("submit",(function(e){(function(e,t,r){var c;e.preventDefault(),(c=g.value,fetch("https://nomoreparties.co/v1/".concat(n,"/users/me/avatar"),{method:"PATCH",headers:{authorization:o,"Content-type":"application/json"},body:JSON.stringify({avatar:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){r.style.backgroundImage="url(".concat(e.avatar,")")})),i(t)})(e,B,U),E($,Q)})),I.addEventListener("click",(function(){a(M),V.reset(),E(V,Q)})),V.addEventListener("submit",(function(e){!function(e,r){e.preventDefault();var a,u,l=b.value,s=S.value;Promise.all([(a=l,u=s,fetch("".concat(t,"/v1/").concat(n,"/cards"),{method:"POST",headers:{authorization:o,"Content-type":"application/json"},body:JSON.stringify({name:a,link:u})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))),c()]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];G.prepend(f(r,{deleteCard:p,openImageModal:R,openDeleteModal:W},c))})),_.reset(),i(r)}(e,M),E(V,Q)})),q=(L=Q).formSelector,j=L.inputSelector,A=L.submitButtonSelector,P=L.inactiveButtonClass,w=L.inputErrorClass,x=L.errorClass,Array.from(document.querySelectorAll(q)).forEach((function(e){!function(e,t,n,o,r,c){Array.from(e.querySelectorAll(t)).forEach((function(e){e.addEventListener("input",(function(){!function(e,t,n,o,r){var c=document.querySelectorAll(t);e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?(k(e,o,r),c.forEach((function(e){e.classList.remove(n)}))):(function(e,t,n,o){var r=document.querySelector(".".concat(e.id,"-error"));e.classList.add(n),r.textContent=t,r.classList.add(o)}(e,e.validationMessage,o,r),c.forEach((function(e){e.classList.add(n)})))}(e,n,o,r,c)}))}))}(e,j,A,P,w,x)})),Promise.all([c(),fetch("".concat(t,"/v1/").concat(n,"/cards"),{method:"GET",headers:{authorization:o}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];N.textContent=r.name,J.textContent=r.about,U.style.backgroundImage="url(".concat(r.avatar,")"),c.forEach((function(e){var t=f(e,{deleteCard:p,openImageModal:R,openDeleteModal:W},r);return G.append(t)}))}))})();